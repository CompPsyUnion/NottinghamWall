{"remainingRequest":"D:\\NottinghamWall-old\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\NottinghamWall-old\\admin\\node_modules\\ts-loader\\index.js??ref--14-2!D:\\NottinghamWall-old\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\NottinghamWall-old\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\NottinghamWall-old\\admin\\src\\layout\\components\\Navbar\\index.vue?vue&type=script&lang=ts&","dependencies":[{"path":"D:\\NottinghamWall-old\\admin\\src\\layout\\components\\Navbar\\index.vue","mtime":1719220369021},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/asyncToGenerator\"));\n\nrequire(\"core-js/modules/es6.regexp.to-string\");\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/inherits\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _vuePropertyDecorator = require(\"vue-property-decorator\");\n\nvar _app = require(\"@/store/modules/app\");\n\nvar _user = require(\"@/store/modules/user\");\n\nvar _index = _interopRequireDefault(require(\"@/components/Breadcrumb/index.vue\"));\n\nvar _index2 = _interopRequireDefault(require(\"@/components/Hamburger/index.vue\"));\n\nvar _users = require(\"@/api/users\");\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar _inform = require(\"@/api/inform\");\n\nvar _password = _interopRequireDefault(require(\"../components/password.vue\"));\n\n// 接口\n// 修改密码弹层\nvar default_1 =\n/*#__PURE__*/\nfunction (_Vue) {\n  (0, _inherits2.default)(default_1, _Vue);\n\n  function default_1() {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, default_1);\n    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(default_1).apply(this, arguments));\n    _this.storeId = _this.getStoreId;\n    _this.restKey = 0;\n    _this.websocket = null;\n    _this.newOrder = '';\n    _this.message = '';\n    _this.audioIsPlaying = false;\n    _this.audioPaused = false;\n    _this.statusValue = true;\n    _this.shopShow = false;\n    _this.dialogVisible = false;\n    _this.status = 1;\n    _this.setStatus = 1;\n    _this.dialogFormVisible = false;\n    _this.ountUnread = 0;\n    return _this;\n  } // get ountUnread() {\n  //   return Number(getNewData())\n  // }\n\n\n  (0, _createClass2.default)(default_1, [{\n    key: \"getuserInfo\",\n    value: function getuserInfo() {\n      return _user.UserModule.userInfo;\n    }\n  }, {\n    key: \"mounted\",\n    value: function mounted() {\n      document.addEventListener('click', this.handleClose); //console.log(this.$store.state.app.statusNumber)\n      // const msg = {\n      //   data: {\n      //     type: 2,\n      //     content: '订单1653904906519客户催单，已下单23分钟，仍未接单。',\n      //     details: '434'\n      //   }\n      // }\n\n      this.getStatus();\n    }\n  }, {\n    key: \"created\",\n    value: function created() {\n      this.webSocket();\n    }\n  }, {\n    key: \"onload\",\n    value: function onload() {}\n  }, {\n    key: \"destroyed\",\n    value: function destroyed() {\n      this.websocket.close(); //离开路由之后断开websocket连接\n    } // 添加新订单提示弹窗\n\n  }, {\n    key: \"webSocket\",\n    value: function webSocket() {\n      var that = this;\n      var clientId = Math.random().toString(36).substr(2);\n      var socketUrl = process.env.VUE_APP_SOCKET_URL + clientId;\n      console.log(socketUrl, 'socketUrl');\n\n      if (typeof WebSocket == 'undefined') {\n        that.$notify({\n          title: '提示',\n          message: '当前浏览器无法接收实时报警信息，请使用谷歌浏览器！',\n          type: 'warning',\n          duration: 0\n        });\n      } else {\n        this.websocket = new WebSocket(socketUrl); // 监听socket打开\n\n        this.websocket.onopen = function () {\n          console.log('浏览器WebSocket已打开');\n        }; // 监听socket消息接收\n\n\n        this.websocket.onmessage = function (msg) {\n          // 转换为json对象\n          that.$refs.audioVo.currentTime = 0;\n          that.$refs.audioVo2.currentTime = 0;\n          console.log(msg, JSON.parse(msg.data), 'msg'); // const h = this.$createElement\n\n          var jsonMsg = JSON.parse(msg.data);\n\n          if (jsonMsg.type === 1) {\n            that.$refs.audioVo.play();\n          } else if (jsonMsg.type === 2) {\n            that.$refs.audioVo2.play();\n          }\n\n          that.$notify({\n            title: jsonMsg.type === 1 ? '待接单' : '催单',\n            duration: 0,\n            dangerouslyUseHTMLString: true,\n            onClick: function onClick() {\n              that.$router.push(\"/order?orderId=\".concat(jsonMsg.orderId)).catch(function (err) {\n                console.log(err);\n              });\n              setTimeout(function () {\n                location.reload();\n              }, 100);\n            },\n            // 这里也可以把返回信息加入到message中显示\n            message: \"\".concat(jsonMsg.type === 1 ? \"<span>\\u60A8\\u67091\\u4E2A<span style=color:#419EFF>\\u8BA2\\u5355\\u5F85\\u5904\\u7406</span>,\".concat(jsonMsg.content, \",\\u8BF7\\u53CA\\u65F6\\u63A5\\u5355</span>\") : \"\".concat(jsonMsg.content, \"<span style='color:#419EFF;cursor: pointer'>\\u53BB\\u5904\\u7406</span>\"))\n          });\n        }; // 监听socket错误\n\n\n        this.websocket.onerror = function () {\n          that.$notify({\n            title: '错误',\n            message: '服务器错误，无法接收实时报警信息',\n            type: 'error',\n            duration: 0\n          });\n        }; // 监听socket关闭\n\n\n        this.websocket.onclose = function () {\n          console.log('WebSocket已关闭');\n        };\n      }\n    }\n  }, {\n    key: \"toggleSideBar\",\n    value: function toggleSideBar() {\n      _app.AppModule.ToggleSideBar(false);\n    } // 退出\n\n  }, {\n    key: \"logout\",\n    value: function () {\n      var _logout = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.$store.dispatch('LogOut').then(function () {\n                  // location.href = '/'\n                  _this2.$router.replace({\n                    path: '/login'\n                  });\n                }); // this.$router.push(`/login?redirect=${this.$route.fullPath}`)\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function logout() {\n        return _logout.apply(this, arguments);\n      }\n\n      return logout;\n    }() // 获取未读消息\n\n  }, {\n    key: \"getCountUnread\",\n    value: function () {\n      var _getCountUnread2 = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return (0, _inform.getCountUnread)();\n\n              case 2:\n                _ref = _context2.sent;\n                data = _ref.data;\n\n                if (data.code === 1) {\n                  // this.ountUnread = data.data\n                  _app.AppModule.StatusNumber(data.data); // setNewData(data.data)\n                  // this.$message.success('操作成功！')\n\n                } else {\n                  this.$message.error(data.msg);\n                }\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getCountUnread() {\n        return _getCountUnread2.apply(this, arguments);\n      }\n\n      return getCountUnread;\n    }() // 营业状态\n\n  }, {\n    key: \"getStatus\",\n    value: function () {\n      var _getStatus2 = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return (0, _users.getStatus)();\n\n              case 2:\n                _ref2 = _context3.sent;\n                data = _ref2.data;\n                this.status = data.data;\n                this.setStatus = this.status;\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getStatus() {\n        return _getStatus2.apply(this, arguments);\n      }\n\n      return getStatus;\n    }() // 下拉菜单显示\n\n  }, {\n    key: \"toggleShow\",\n    value: function toggleShow() {\n      this.shopShow = true;\n    } // 下拉菜单隐藏\n\n  }, {\n    key: \"mouseLeaves\",\n    value: function mouseLeaves() {\n      this.shopShow = false;\n    } // 触发空白处下来菜单关闭\n\n  }, {\n    key: \"handleClose\",\n    value: function handleClose() {} // clearTimeout(this.leave)\n    // this.shopShow = false\n    // 设置营业状态\n\n  }, {\n    key: \"handleStatus\",\n    value: function handleStatus() {\n      this.dialogVisible = true;\n    } // 营业状态设置\n\n  }, {\n    key: \"handleSave\",\n    value: function () {\n      var _handleSave = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4() {\n        var _ref3, data;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return (0, _users.setStatus)(this.setStatus);\n\n              case 2:\n                _ref3 = _context4.sent;\n                data = _ref3.data;\n\n                if (data.code === 1) {\n                  this.dialogVisible = false;\n                  this.getStatus();\n                }\n\n              case 5:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function handleSave() {\n        return _handleSave.apply(this, arguments);\n      }\n\n      return handleSave;\n    }() // 修改密码\n\n  }, {\n    key: \"handlePwd\",\n    value: function handlePwd() {\n      this.dialogFormVisible = true;\n    } // 关闭密码编辑弹层\n\n  }, {\n    key: \"handlePwdClose\",\n    value: function handlePwdClose() {\n      this.dialogFormVisible = false;\n    }\n  }, {\n    key: \"sidebar\",\n    get: function get() {\n      return _app.AppModule.sidebar;\n    }\n  }, {\n    key: \"device\",\n    get: function get() {\n      return _app.AppModule.device.toString();\n    }\n  }, {\n    key: \"name\",\n    get: function get() {\n      return _user.UserModule.userInfo.name ? _user.UserModule.userInfo.name : JSON.parse(_jsCookie.default.get('user_info')).name;\n    }\n  }, {\n    key: \"getStoreId\",\n    get: function get() {\n      var storeId = '';\n\n      if (_user.UserModule.storeId) {\n        storeId = _user.UserModule.storeId;\n      } else if (_user.UserModule.userInfo.stores != null) {\n        storeId = _user.UserModule.userInfo.stores[0].storeId;\n      }\n\n      return storeId;\n    }\n  }]);\n  return default_1;\n}(_vuePropertyDecorator.Vue);\n\ndefault_1 = (0, _tslib.__decorate)([(0, _vuePropertyDecorator.Component)({\n  name: 'Navbar',\n  components: {\n    Breadcrumb: _index.default,\n    Hamburger: _index2.default,\n    Password: _password.default\n  }\n})], default_1);\nvar _default = default_1;\nexports.default = _default;",{"version":3,"sources":["D:\\NottinghamWall-old\\admin\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\NottinghamWall-old\\admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\NottinghamWall-old\\admin\\src\\layout\\components\\Navbar\\index.vue?vue&type=script&lang=ts&"],"names":[],"mappings":"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","sourcesContent":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue, Watch } from 'vue-property-decorator'\nimport { AppModule } from '@/store/modules/app'\nimport { UserModule } from '@/store/modules/user'\nimport Breadcrumb from '@/components/Breadcrumb/index.vue'\nimport Hamburger from '@/components/Hamburger/index.vue'\nimport { getStatus, setStatus } from '@/api/users'\nimport Cookies from 'js-cookie'\nimport { debounce, throttle } from '@/utils/common'\nimport { setNewData, getNewData } from '@/utils/cookies'\n\n// 接口\nimport { getCountUnread } from '@/api/inform'\n// 修改密码弹层\nimport Password from '../components/password.vue'\n\n@Component({\n  name: 'Navbar',\n  components: {\n    Breadcrumb,\n    Hamburger,\n    Password,\n  },\n})\nexport default class extends Vue {\n  private storeId = this.getStoreId\n  private restKey: number = 0\n  private websocket = null\n  private newOrder = ''\n  private message = ''\n  private audioIsPlaying = false\n  private audioPaused = false\n  private statusValue = true\n  private audioUrl: './../../../assets/preview.mp3'\n  private shopShow = false\n  private dialogVisible = false\n  private status = 1\n  private setStatus = 1\n  private dialogFormVisible = false\n  private ountUnread = 0\n  // get ountUnread() {\n  //   return Number(getNewData())\n  // }\n  get sidebar() {\n    return AppModule.sidebar\n  }\n\n  get device() {\n    return AppModule.device.toString()\n  }\n\n  getuserInfo() {\n    return UserModule.userInfo\n  }\n\n  get name() {\n    return (UserModule.userInfo as any).name\n      ? (UserModule.userInfo as any).name\n      : JSON.parse(Cookies.get('user_info') as any).name\n  }\n\n  get getStoreId() {\n    let storeId = ''\n    if (UserModule.storeId) {\n      storeId = UserModule.storeId\n    } else if ((UserModule.userInfo as any).stores != null) {\n      storeId = (UserModule.userInfo as any).stores[0].storeId\n    }\n    return storeId\n  }\n  mounted() {\n    document.addEventListener('click', this.handleClose)\n    //console.log(this.$store.state.app.statusNumber)\n    // const msg = {\n    //   data: {\n    //     type: 2,\n    //     content: '订单1653904906519客户催单，已下单23分钟，仍未接单。',\n    //     details: '434'\n    //   }\n    // }\n    this.getStatus()\n  }\n  created() {\n    this.webSocket()\n  }\n  onload() {\n  }\n  destroyed() {\n    this.websocket.close() //离开路由之后断开websocket连接\n  }\n\n  // 添加新订单提示弹窗\n  webSocket() {\n    const that = this as any\n    let clientId = Math.random().toString(36).substr(2)\n    let socketUrl = process.env.VUE_APP_SOCKET_URL + clientId\n    console.log(socketUrl, 'socketUrl')\n    if (typeof WebSocket == 'undefined') {\n      that.$notify({\n        title: '提示',\n        message: '当前浏览器无法接收实时报警信息，请使用谷歌浏览器！',\n        type: 'warning',\n        duration: 0,\n      })\n    } else {\n      this.websocket = new WebSocket(socketUrl)\n      // 监听socket打开\n      this.websocket.onopen = function () {\n        console.log('浏览器WebSocket已打开')\n      }\n      // 监听socket消息接收\n      this.websocket.onmessage = function (msg) {\n        // 转换为json对象\n        that.$refs.audioVo.currentTime = 0\n        that.$refs.audioVo2.currentTime = 0\n\n        console.log(msg, JSON.parse(msg.data), 'msg')\n        // const h = this.$createElement\n        const jsonMsg = JSON.parse(msg.data)\n        if (jsonMsg.type === 1) {\n          that.$refs.audioVo.play()\n        } else if (jsonMsg.type === 2) {\n          that.$refs.audioVo2.play()\n        }\n        that.$notify({\n          title: jsonMsg.type === 1 ? '待接单' : '催单',\n          duration: 0,\n          dangerouslyUseHTMLString: true,\n          onClick: () => {\n            that.$router\n              .push(`/order?orderId=${jsonMsg.orderId}`)\n              .catch((err) => {\n                console.log(err)\n              })\n            setTimeout(() => {\n              location.reload()\n            }, 100)\n          },\n          // 这里也可以把返回信息加入到message中显示\n          message: `${\n            jsonMsg.type === 1\n              ? `<span>您有1个<span style=color:#419EFF>订单待处理</span>,${jsonMsg.content},请及时接单</span>`\n              : `${jsonMsg.content}<span style='color:#419EFF;cursor: pointer'>去处理</span>`\n          }`,\n        })\n      }\n      // 监听socket错误\n      this.websocket.onerror = function () {\n        that.$notify({\n          title: '错误',\n          message: '服务器错误，无法接收实时报警信息',\n          type: 'error',\n          duration: 0,\n        })\n      }\n      // 监听socket关闭\n      this.websocket.onclose = function () {\n        console.log('WebSocket已关闭')\n      }\n    }\n  }\n\n  private toggleSideBar() {\n    AppModule.ToggleSideBar(false)\n  }\n  // 退出\n  private async logout() {\n    this.$store.dispatch('LogOut').then(() => {\n      // location.href = '/'\n      this.$router.replace({ path: '/login' })\n    })\n    // this.$router.push(`/login?redirect=${this.$route.fullPath}`)\n  }\n  // 获取未读消息\n  async getCountUnread() {\n    const { data } = await getCountUnread()\n    if (data.code === 1) {\n      // this.ountUnread = data.data\n      AppModule.StatusNumber(data.data)\n      // setNewData(data.data)\n      // this.$message.success('操作成功！')\n    } else {\n      this.$message.error(data.msg)\n    }\n  }\n  // 营业状态\n  async getStatus() {\n    const { data } = await getStatus()\n    this.status = data.data\n    this.setStatus = this.status\n  }\n  // 下拉菜单显示\n  toggleShow() {\n    this.shopShow = true\n  }\n  // 下拉菜单隐藏\n  mouseLeaves() {\n    this.shopShow = false\n  }\n  // 触发空白处下来菜单关闭\n  handleClose() {\n    // clearTimeout(this.leave)\n    // this.shopShow = false\n  }\n  // 设置营业状态\n  handleStatus() {\n    this.dialogVisible = true\n  }\n  // 营业状态设置\n  async handleSave() {\n    const { data } = await setStatus(this.setStatus)\n    if (data.code === 1) {\n      this.dialogVisible = false\n      this.getStatus()\n    }\n  }\n  // 修改密码\n  handlePwd() {\n    this.dialogFormVisible = true\n  }\n  // 关闭密码编辑弹层\n  handlePwdClose() {\n    this.dialogFormVisible = false\n  }\n}\n"],"sourceRoot":""}]}