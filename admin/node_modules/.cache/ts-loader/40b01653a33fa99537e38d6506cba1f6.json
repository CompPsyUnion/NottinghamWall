{"remainingRequest":"D:\\NottinghamWall-old\\admin\\node_modules\\babel-loader\\lib\\index.js!D:\\NottinghamWall-old\\admin\\node_modules\\ts-loader\\index.js??ref--14-2!D:\\NottinghamWall-old\\admin\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\NottinghamWall-old\\admin\\src\\store\\modules\\user.ts","dependencies":[{"path":"D:\\NottinghamWall-old\\admin\\src\\store\\modules\\user.ts","mtime":1718971334165},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"D:\\NottinghamWall-old\\admin\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserModule = void 0;\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"D:\\\\NottinghamWall-old\\\\admin\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/inherits\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _vuexModuleDecorators = require(\"vuex-module-decorators\");\n\nvar _admin = require(\"@/api/admin\");\n\nvar _cookies = require(\"@/utils/cookies\");\n\nvar _store = _interopRequireDefault(require(\"@/store\"));\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar _elementUi = require(\"element-ui\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar User =\n/*#__PURE__*/\nfunction (_VuexModule) {\n  (0, _inherits2.default)(User, _VuexModule);\n\n  function User() {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, User);\n    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(User).apply(this, arguments));\n    _this.token = (0, _cookies.getToken)() || '';\n    _this.name = '';\n    _this.avatar = ''; // @ts-ignore\n\n    _this.storeId = (0, _cookies.getStoreId)() || '';\n    _this.introduction = '';\n    _this.userInfo = {};\n    _this.roles = [];\n    _this.username = _jsCookie.default.get('username') || '';\n    return _this;\n  }\n\n  (0, _createClass2.default)(User, [{\n    key: \"SET_TOKEN\",\n    value: function SET_TOKEN(token) {\n      this.token = token;\n    }\n  }, {\n    key: \"SET_NAME\",\n    value: function SET_NAME(name) {\n      this.name = name;\n    }\n  }, {\n    key: \"SET_USERINFO\",\n    value: function SET_USERINFO(userInfo) {\n      this.userInfo = _objectSpread({}, userInfo);\n    }\n  }, {\n    key: \"SET_AVATAR\",\n    value: function SET_AVATAR(avatar) {\n      this.avatar = avatar;\n    }\n  }, {\n    key: \"SET_INTRODUCTION\",\n    value: function SET_INTRODUCTION(introduction) {\n      this.introduction = introduction;\n    }\n  }, {\n    key: \"SET_ROLES\",\n    value: function SET_ROLES(roles) {\n      this.roles = roles;\n    }\n  }, {\n    key: \"SET_STOREID\",\n    value: function SET_STOREID(storeId) {\n      this.storeId = storeId;\n    }\n  }, {\n    key: \"SET_USERNAME\",\n    value: function SET_USERNAME(name) {\n      this.username = name;\n    }\n  }, {\n    key: \"Login\",\n    value: function () {\n      var _Login = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(userInfo) {\n        var username, password, _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                username = userInfo.username, password = userInfo.password;\n                username = username.trim();\n                _context.next = 4;\n                return (0, _admin.login)({\n                  username: username,\n                  password: password\n                });\n\n              case 4:\n                _ref = _context.sent;\n                data = _ref.data;\n\n                if (!(String(data.code) === '1')) {\n                  _context.next = 16;\n                  break;\n                }\n\n                //设置vuex中属性的值\n                this.SET_USERNAME(username);\n                this.SET_TOKEN(data.data.token);\n                this.SET_USERINFO(data.data); //保存到Cookie中\n\n                _jsCookie.default.set('username', username);\n\n                _jsCookie.default.set('user_info', data.data);\n\n                _jsCookie.default.set(\"token\", data.data.token);\n\n                return _context.abrupt(\"return\", data);\n\n              case 16:\n                return _context.abrupt(\"return\", _elementUi.Message.error(data.msg));\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function Login(_x) {\n        return _Login.apply(this, arguments);\n      }\n\n      return Login;\n    }()\n  }, {\n    key: \"ResetToken\",\n    value: function ResetToken() {\n      (0, _cookies.removeToken)();\n      this.SET_TOKEN('');\n      this.SET_ROLES([]);\n    }\n  }, {\n    key: \"changeStore\",\n    value: function () {\n      var _changeStore = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(data) {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.SET_STOREID = data.data;\n                this.SET_TOKEN(data.authorization);\n                (0, _cookies.setStoreId)(data.data);\n                (0, _cookies.setToken)(data.authorization);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function changeStore(_x2) {\n        return _changeStore.apply(this, arguments);\n      }\n\n      return changeStore;\n    }()\n  }, {\n    key: \"GetUserInfo\",\n    value: function () {\n      var _GetUserInfo = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var data, roles, name, avatar, introduction, applicant, storeManagerName, _data$storeId, storeId;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(this.token === '')) {\n                  _context3.next = 2;\n                  break;\n                }\n\n                throw Error('GetUserInfo: token is undefined!');\n\n              case 2:\n                data = JSON.parse((0, _cookies.getUserInfo)()); //  { roles: ['admin'], name: 'zhangsan', avatar: '/login', introduction: '' }\n\n                if (data) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                throw Error('Verification failed, please Login again.');\n\n              case 5:\n                roles = data.roles, name = data.name, avatar = data.avatar, introduction = data.introduction, applicant = data.applicant, storeManagerName = data.storeManagerName, _data$storeId = data.storeId, storeId = _data$storeId === void 0 ? '' : _data$storeId; // data.user\n                // roles must be a non-empty array\n\n                if (!(!roles || roles.length <= 0)) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                throw Error('GetUserInfo: roles must be a non-null array!');\n\n              case 8:\n                this.SET_ROLES(roles);\n                this.SET_USERINFO(data);\n                this.SET_NAME(name || applicant || storeManagerName);\n                this.SET_AVATAR(avatar);\n                this.SET_INTRODUCTION(introduction);\n\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function GetUserInfo() {\n        return _GetUserInfo.apply(this, arguments);\n      }\n\n      return GetUserInfo;\n    }()\n  }, {\n    key: \"LogOut\",\n    value: function () {\n      var _LogOut = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4() {\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return (0, _admin.adminLogout)({});\n\n              case 2:\n                _ref2 = _context4.sent;\n                data = _ref2.data;\n                (0, _cookies.removeToken)();\n                this.SET_TOKEN('');\n                this.SET_ROLES([]);\n\n                _jsCookie.default.remove('username');\n\n                _jsCookie.default.remove('user_info');\n\n                (0, _cookies.removeUserInfo)();\n\n              case 10:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function LogOut() {\n        return _LogOut.apply(this, arguments);\n      }\n\n      return LogOut;\n    }()\n  }]);\n  return User;\n}(_vuexModuleDecorators.VuexModule);\n\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_TOKEN\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_NAME\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_USERINFO\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_AVATAR\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_INTRODUCTION\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_ROLES\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_STOREID\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Mutation], User.prototype, \"SET_USERNAME\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Action], User.prototype, \"Login\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Action], User.prototype, \"ResetToken\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Action], User.prototype, \"changeStore\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Action], User.prototype, \"GetUserInfo\", null);\n(0, _tslib.__decorate)([_vuexModuleDecorators.Action], User.prototype, \"LogOut\", null);\nUser = (0, _tslib.__decorate)([(0, _vuexModuleDecorators.Module)({\n  'dynamic': true,\n  store: _store.default,\n  'name': 'user'\n})], User);\nvar UserModule = (0, _vuexModuleDecorators.getModule)(User);\nexports.UserModule = UserModule;",{"version":3,"sources":["D:\\NottinghamWall-old\\admin\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\NottinghamWall-old\\admin\\src\\store\\modules\\user.ts"],"names":[],"mappings":"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","sourcesContent":["import { VuexModule, Module, Action, Mutation, getModule } from 'vuex-module-decorators'\r\nimport { adminLogout, login } from '@/api/admin'\r\nimport { getToken, setToken, removeToken,getStoreId, setStoreId, removeStoreId, setUserInfo, getUserInfo, removeUserInfo } from '@/utils/cookies'\r\nimport store from '@/store'\r\nimport Cookies from 'js-cookie'\r\nimport { Message } from 'element-ui'\r\nexport interface IUserState {\r\n  token: string\r\n  name: string\r\n  avatar: string\r\n  storeId: string\r\n  introduction: string\r\n  userInfo: any\r\n  roles: string[]\r\n  username: string\r\n}\r\n\r\n@Module({ 'dynamic': true, store, 'name': 'user' })\r\nclass User extends VuexModule implements IUserState {\r\n  public token = getToken() || ''\r\n  public name = ''\r\n  public avatar = ''\r\n  // @ts-ignore\r\n  public storeId: string = getStoreId() || ''\r\n  public introduction = ''\r\n  public userInfo = {}\r\n  public roles: string[] = []\r\n  public username = Cookies.get('username') || ''\r\n\r\n  @Mutation\r\n  private SET_TOKEN(token: string) {\r\n    this.token = token\r\n  }\r\n\r\n  @Mutation\r\n  private SET_NAME(name: string) {\r\n    this.name = name\r\n  }\r\n\r\n  @Mutation\r\n  private SET_USERINFO(userInfo: any) {\r\n    this.userInfo = { ...userInfo }\r\n  }\r\n\r\n  @Mutation\r\n  private SET_AVATAR(avatar: string) {\r\n    this.avatar = avatar\r\n  }\r\n\r\n  @Mutation\r\n  private SET_INTRODUCTION(introduction: string) {\r\n    this.introduction = introduction\r\n  }\r\n\r\n  @Mutation\r\n  private SET_ROLES(roles: string[]) {\r\n    this.roles = roles\r\n  }\r\n\r\n  @Mutation\r\n  private SET_STOREID(storeId: string) {\r\n    this.storeId = storeId\r\n  }\r\n  @Mutation\r\n  private SET_USERNAME(name: string) {\r\n    this.username = name\r\n    }\r\n\r\n  @Action\r\n  public async Login(userInfo: { username: string, password: string }) {\r\n    let { username, password } = userInfo\r\n    username = username.trim()\r\n    const { data } = await login({ username, password })\r\n    if (String(data.code) === '1') {\r\n      //设置vuex中属性的值\r\n      this.SET_USERNAME(username)\r\n      this.SET_TOKEN(data.data.token)\r\n      this.SET_USERINFO(data.data)\r\n\r\n      //保存到Cookie中\r\n      Cookies.set('username', username)\r\n      Cookies.set('user_info', data.data)\r\n      Cookies.set(\"token\", data.data.token);\r\n      return data\r\n    } else {\r\n      return Message.error(data.msg)\r\n    }\r\n  }\r\n\r\n  @Action\r\n  public ResetToken () {\r\n    removeToken()\r\n    this.SET_TOKEN('')\r\n    this.SET_ROLES([])\r\n  }\r\n\r\n  @Action\r\n  public async changeStore(data: any) {\r\n    this.SET_STOREID = data.data\r\n    this.SET_TOKEN(data.authorization)\r\n    setStoreId(data.data)\r\n    setToken(data.authorization)\r\n  }\r\n\r\n  @Action\r\n  public async GetUserInfo () {\r\n    if (this.token === '') {\r\n      throw Error('GetUserInfo: token is undefined!')\r\n    }\r\n\r\n    const data = JSON.parse(<string>getUserInfo()) //  { roles: ['admin'], name: 'zhangsan', avatar: '/login', introduction: '' }\r\n    if (!data) {\r\n      throw Error('Verification failed, please Login again.')\r\n    }\r\n\r\n    const { roles, name, avatar, introduction, applicant, storeManagerName, storeId='' } = data // data.user\r\n    // roles must be a non-empty array\r\n    if (!roles || roles.length <= 0) {\r\n      throw Error('GetUserInfo: roles must be a non-null array!')\r\n    }\r\n\r\n    this.SET_ROLES(roles)\r\n    this.SET_USERINFO(data)\r\n    this.SET_NAME(name || applicant || storeManagerName)\r\n    this.SET_AVATAR(avatar)\r\n    this.SET_INTRODUCTION(introduction)\r\n  }\r\n\r\n  @Action\r\n  public async LogOut () {\r\n    const { data } = await adminLogout({})\r\n    removeToken()\r\n    this.SET_TOKEN('')\r\n    this.SET_ROLES([])\r\n    Cookies.remove('username')\r\n    Cookies.remove('user_info')\r\n    removeUserInfo()\r\n  }\r\n}\r\n\r\nexport const UserModule = getModule(User)\r\n"],"sourceRoot":""}]}